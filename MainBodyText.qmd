---
editor: 
  markdown: 
    wrap: 72
---

# Put your section header here in R {.unnumbered}

Replace the above header with whatever you need for your tech memo.
Add subsequent headers below in this document. You can incorporate code,
figures, tables, etc. Whatever you need for your document.

# Some additional guidance

The Word template for PIFSC Tech Memos has a ton of helpful
information on how to format figures, tables, and more. You should check
that out, even if you're not going to use the Word template, if only
because it'll help you help our editors.

This section includes a portion of the Word template guidance
(seriously, you should check out the actual template), focusing on how to
incorporate requirements into your code and things you'll need to do in
Word.

## Handy tips for aligning your code with the PIFSC template

The files to make these examples work are all in the ExampleContent
folder of this repository.

### Imported images

Here are two examples of how to import a figure with cross referencing. The
first example uses Markdown to call the file.  The second example uses R. \
You can see more at:
<https://quarto.org/docs/authoring/cross-references.html>

![](ExampleContent/IRCatDusk.jpg){#fig-IRC
alt="An illuminated office building at dusk with palm trees and grass in the foreground"}

```{r}
#| echo: false
#| label: fig-IRC2
#| fig-cap: "The Inouye Regional Center (IRC)"
#| fig-alt: "An illuminated office building at dusk with palm trees adn grass in the foreground"

knitr::include_graphics("ExampleContent/IRCatDusk.jpg")
```

These methods allow you reference your figures within the text, for
example both @fig-IRC and @fig-IRC2 show the same thing. You need to start your
figure label with 'fig-' regardless of which method you use (in-line or with a
chunk of R code).   

Frustratingly, these methods do not retain your alt text (a known Quarto
bug), allow Word to recognize your figure as a figure when building a
list of figures (frustrating), or let you use the PIFSC "Caption" style
(also frustrating). BUT, they're better than having to paste all your
figures in by hand. As a workaround, after you render your document,
you'll need to add figure captions and alt text in Word. You could
include the text for these in this document to allow you to cut and
paste them in if you want. Just an idea.

Oh, and in Word, you can delete the placeholder captions that Quarto generates.
That appears to be easier than turning them into a Word caption.

#### To add a figure caption

In Word, right-click the image and select “Insert Caption.” Note: it is not
recommended to add the full text during this stage as it has a character
limit. Rather, “insert caption” as “Figure #.” then continue to add the
text once the caption is produced.

To format the added caption, highlight the text and go to Home \> Style
\> Caption. Bold the figure number only. Keep the figure
center-justified and the caption left-justified.

#### To add alternative text

In Word, right-click the image and select “Edit Alt Text.”

::: {custom-style="Emphasis 1"}
Tell me more about alt text
:::

Alternative text allows figures to be understood by those who are unable
to see the figure. It's also a 508-compliance requirement. Alt text
should be short and sweet, like a tweet. Don’t include language like
“image of” or “photo of.” It is okay to reference what type of graph is
being used (i.e., bar chart). The PIFSC Publications intranet page has a
[guide on creating alternative
text](https://sites.google.com/noaa.gov/pifsc-intranet/publications-station/citations-and-508-compliance).

::: {custom-style="Emphasis 1"}
Can the auto-generated alt text function be used?
:::

The editorial team has messed around with Word’s new auto generated alt
text and did not find the alternative text to be robust enough to meet
508 compliance standards for figures. The auto generated feature can be
used as a skeleton, however, authors are still responsible for ensuring
that the alternative text meets the standards outlined on the [508
compliance](https://sites.google.com/noaa.gov/pifsc-intranet/publications-station/citations-and-508-compliance)
intranet page.

**All figures are required to have captions and alternative text.**

### Images generated by document code

You can also include code within your tech memo to generate the
figures, rather than importing them. The code below walks through an
example of how to do this.

Some notes about the code:\
- `echo: false` prevents the code from showing up in your document. If
you *want* to include code, delete this line.\
- `message: false` prevents messages that result from running your code
from showing up in your document.\
- `label: fig-co2growth` allows you to create a cross reference to the
figure in your text. There's an example of this below the code.\
- calling `par(bg = NA)` before plotting creates a transparent
background, which comports with the PIFSC template. If you are
generating a figure that you're going to save and then import, you can
use `bg = "transparent"` in the command to save your figure instead.

```{r}
#| echo: false
#| message: false
#| label: fig-co2growth
#| fig-cap: Annual increase in atmospheric CO~2~
#| fig-alt: Line graph showing increasing growth rate over time
#| out-width: 5in

# Load the libraries we'll need
library(tidyverse, quietly = TRUE)
library(nmfspalette) # https://nmfs-fish-tools.github.io/nmfspalette/

# This example uses data from the Mauna Loa observatory.
# If you have PIFSC-generated publicly accessible machine-readable data that
# the template could use instead, please open an issue in the repo and suggest it.

# Load data
co2gr <- read_csv("https://gml.noaa.gov/webdata/ccgg/trends/co2/co2_gr_mlo.csv", 
                  skip = 45,
                  show_col_types = FALSE)

# Create expression to include a subscript in the y-axis label
yLabel <- expression(CO[2] ~ Growth ~ Rate ~ (ppm))

# Create the figure with a transparent background
par(bg = NA)
plot(co2gr$year, co2gr$`ann inc`, type = "l", col = nmfs_cols("processblue"),
     xlab = c('Year'), ylab = yLabel, las = 1)

```

As we can see in @fig-co2growth, the amount of carbon dioxide added to
the atmosphere continues to increase over time.

### Tables

These examples walks through how to create a table using code. **Do not
import a table as an image** or the editors will send your Tech Memo
back to you and ask you to replace it with an actual table.

A few things to note about tables in PIFSC Tech Memos:\
- Use consistent significant figures throughout a given table.\
- All blank cells must be filled, even if it's only with a hyphen (this
helps screen readers work).\
- All tables need captions. As with figures, you'll need to add these in
Word.\
- There's some formatting that you'll need to do in Word for the time
being (e.g., subscripts, font). In the meantime, solutions are welcome!

#### Creating a table from a csv

This example creates a table directly from a csv using the `kable`
package. It allows you to rename column headers, align columns,
harmonize the number of digits, format numbers, handle missing values,
and more. You can see more at:
<https://bookdown.org/yihui/rmarkdown-cookbook/kable.html>

```{r}
#| echo: false
#| message: false
#| label: tbl-co2growth
#| tbl-cap: Annual increase in atmospheric CO~2~ of the past 10 years

# Load the library we'll need
library(knitr)

# Filtering data to just the most recent 10 years
Final10years <- co2gr |>
  select(year, `ann inc`) |>
  filter(co2gr$year > 2013)

# Make the table, including:
# renaming the columns (cols_label)
# aligning the text in keeping with the PIFSC template

kable(Final10years,
      col.names = c('Year', 'Annual CO~2~ Increase (ppm)'),
      align = "rr")
```

As @tbl-co2growth demonstrates, you'll need to do some of the formatting by hand
in Word.  Frustratingly, some of the coded instructions (e.g., alignment) don't
seem to be carrying through.  Suggestions for fixing this are welcome!

#### Creating a table by hand

This example creates a table by hand, which can be tedious though is
sometimes necessary.

| **Greenhouse Gas (GHG)** | **Percent of 2022 US GHG Emissions** | **Global Warming Potential** |
|:-------------------------|-------------------------------------:|-----------------------------:|
| Carbon Dioxide (CO~2~)   |                                 79.7 |                            1 |
| Methane (CH~4~)          |                                 11.1 |                           28 |
| Nitrous Oxide (N~2~O)    |                                  6.1 |                          265 |
| Fluoronated Gases        |                                  3.1 |                       5,195* |

: Contribution to 2022 US emissions and 100-year global warming potential of the top 
greenhouse gases {#tbl-GWP}

::: {custom-style="Table Descriptive Text"}
\*average across all fluoronated gasses.  Sources: <https://www.epa.gov/system/files/documents/2025-01/ghg-emission-factors-hub-2025.pdf>, 
<https://www.epa.gov/ghgemissions/overview-greenhouse-gases>.
:::

In the code that creates @tbl-GWP the colons (:) in the line under the header 
denote column alignment.  Although this seems not to be working...  Something to
fix.

#### Landscape orientation for wide tables
If you have a very wide table, you can use landscape orientation to display it 
more cleanly.  Simply enclose your table in fences (:::) designating the page
orientation.  There's an example below.

::: {.landscape}

Check out how wide @tbl-WIDE is.  Thanks to PIFSC's [OceanWatch](https://oceanwatch.pifsc.noaa.gov/)
for supplying the data!

```{r}
#| echo: false
#| message: false
#| label: tbl-WIDE
#| tbl-cap: 2024 monthly ESA OC CCI chlorophyll data 

# Load the data from OceanWatch
# You can go to https://oceanwatch.pifsc.noaa.gov/erddap/griddap/esa-cci-chla-monthly-v6-0.html
# to select other parameters.
# At that site, I selected a single year of monthly data at a single location 
# that happens to be that of Station ALOHA (but this is satellite data)
# and copied the text in the box next to the 'Just generate the URL:' button
chl_dat <- read_csv("https://oceanwatch.pifsc.noaa.gov/erddap/griddap/esa-cci-chla-monthly-v6-0.csvp?chlor_a%5B(2024-01-01T00:00:00Z):1:(2024-12-01T00:00:00Z)%5D%5B(22.75):1:(22.75)%5D%5B(202):1:(202)%5D,MERIS_nobs_sum%5B(2024-01-01T00:00:00Z):1:(2024-12-01T00:00:00Z)%5D%5B(22.75):1:(22.75)%5D%5B(202):1:(202)%5D,MODISA_nobs_sum%5B(2024-01-01T00:00:00Z):1:(2024-12-01T00:00:00Z)%5D%5B(22.75):1:(22.75)%5D%5B(202):1:(202)%5D,OLCI_A_nobs_sum%5B(2024-01-01T00:00:00Z):1:(2024-12-01T00:00:00Z)%5D%5B(22.75):1:(22.75)%5D%5B(202):1:(202)%5D,OLCI_B_nobs_sum%5B(2024-01-01T00:00:00Z):1:(2024-12-01T00:00:00Z)%5D%5B(22.75):1:(22.75)%5D%5B(202):1:(202)%5D,SeaWiFS_nobs_sum%5B(2024-01-01T00:00:00Z):1:(2024-12-01T00:00:00Z)%5D%5B(22.75):1:(22.75)%5D%5B(202):1:(202)%5D,VIIRS_nobs_sum%5B(2024-01-01T00:00:00Z):1:(2024-12-01T00:00:00Z)%5D%5B(22.75):1:(22.75)%5D%5B(202):1:(202)%5D,chlor_a_log10_bias%5B(2024-01-01T00:00:00Z):1:(2024-12-01T00:00:00Z)%5D%5B(22.75):1:(22.75)%5D%5B(202):1:(202)%5D,chlor_a_log10_rmsd%5B(2024-01-01T00:00:00Z):1:(2024-12-01T00:00:00Z)%5D%5B(22.75):1:(22.75)%5D%5B(202):1:(202)%5D,total_nobs_sum%5B(2024-01-01T00:00:00Z):1:(2024-12-01T00:00:00Z)%5D%5B(22.75):1:(22.75)%5D%5B(202):1:(202)%5D")

# Wrangling the data so that we just see the month
# and to lop off some significant figures
# and rename the columns
chl_tidy <- chl_dat |>
  mutate(Month = month(`time (UTC)`)) |>
  mutate(
    `latitude (degrees_north)` = signif(`latitude (degrees_north)`, digits = 4),
    `longitude (degrees_east)` = signif(`longitude (degrees_east)`, digits = 5),
    `chlor_a (mg m-3)` = signif(`chlor_a (mg m-3)`, digits = 3),
    `OLCI_A_nobs_sum` = round(`OLCI_A_nobs_sum`, digits = 0),
    `OLCI_B_nobs_sum` = round(`OLCI_B_nobs_sum`, digits = 0),
    `chlor_a_log10_bias` = signif(`chlor_a_log10_bias`, digits = 3),
    `chlor_a_log10_rmsd` = signif(`chlor_a_log10_rmsd`, digits = 3),
    `total_nobs_sum` = round(`total_nobs_sum`, digits = 0),
    `time (UTC)` = NULL, # omitting this column since we have Month
  ) |>
  select(Month, everything()) |> # reordering so Month is first
  rename(
    `Lat (°N)` = `latitude (degrees_north)`,
    `Lon (°E)` = `longitude (degrees_east)`
  )

# Plus drop the columns were all values are NaNs
chl_tidy <- chl_tidy |>
  select(where(~ !all(is.na(.))))

# Make the table, including:
# aligning the text in keeping with the PIFSC template

kable(chl_tidy,
      align = "rr")
```

:::

### Equations
Need to display equations that you've used?  You can do that!  There are a few
examples below to get you started.  You can also find a handy resource for 
coding equations here: <https://www.overleaf.com/learn>.  Follow the links under 
the "Mathematics" heading on the left-hand side.

One thing to note: you'll need to number equations manually in Word after you render
the Tech Memo.  Numbering them in the code that creates the equation causes the
number to be included in Word's Equation Editor, which causes problems for 508
compliance. 

Simple, centered equation:  
$$
\begin{align}
s = T(T_{max} - T)(T - T_{min})
\end{align}
$$
More formatting in this example: 
$$
\begin{align}
r = e^{25.22-\frac{E}{kT}}
\end{align}
$$
Partial differential equations:
$$
\begin{align}
\frac{\partial N_{C}}{\partial t} = -\frac{\partial }{\partial m}(GN_{C}) - DN_{C}
\end{align}
$$
Integral with limits: 
$$
\begin{align}
0.5N = \int_{x_{min}}^{x_{med}} (bx + a)\,dx
\end{align}
$$
Fraction, overbars, subsrcipts: 
$$
\begin{align}
b = \frac{N_{sm} - N_{lg}}{\bar{x}_{sm} - \bar{x}_{lg}}
\end{align}
$$

## Citations and references
PIFSC Tech Memos use APA 7th edition formatting for references and citations.  
Here's an example of citing @Nguyen2019 and Nguyen et al. (2019) in text 
two different ways.  Curious about the difference between those citation styles?  
Review the file `LiteratureCited.qmd` to see important details about coding your 
references and citations.  You have options and you have to choose among them.  
Action is required on your part, if only to delete a line of code.

The sole purpose of this sentence is to cite @Soto2017, @Pegion2019, and 
@AnnualReport so that these populate the References section.
